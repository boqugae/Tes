<!DOCTYPE html>
<html>
<head>
  <title>Camera Android</title>
  <style>
    video { width: 300px; height: auto; }
    textarea { width: 100%; height: 100px; }
  </style>
</head>
<body>

<h2>Ambil Foto Kamera Depan & Belakang (Android)</h2>

<video id="video" autoplay playsinline></video><br>

<button onclick="startFront()">Aktifkan Kamera Depan</button>
<button onclick="startBack()">Aktifkan Kamera Belakang</button>
<button onclick="capture()">Ambil Foto</button>

<textarea id="output"></textarea>

<canvas id="canvas" style="display:none;"></canvas>

<script>
let stream;

// 1. Start kamera depan dulu agar izin terbuka
async function startFront() {
  if (stream) stopTracks();

  try {
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "user" },
      audio: false
    });

    document.getElementById("video").srcObject = stream;
  } catch (e) {
    alert("Gagal mengakses kamera depan: " + e);
  }
}

// 2. Ambil deviceId dari kamera belakang (setelah user memberi izin)
async function startBack() {
  if (stream) stopTracks();

  try {
    const devices = await navigator.mediaDevices.enumerateDevices();

    // Cari camera yang mengandung kata "back"
    const backCam = devices.find(d =>
      d.kind === "videoinput" &&
      d.label.toLowerCase().includes("back")
    );

    if (!backCam) {
      alert("Kamera belakang tidak terdeteksi di perangkat ini!");
      return;
    }

    stream = await navigator.mediaDevices.getUserMedia({
      video: { deviceId: backCam.deviceId },
      audio: false
    });

    document.getElementById("video").srcObject = stream;

  } catch (e) {
    alert("Gagal mengakses kamera belakang: " + e);
  }
}

function stopTracks() {
  stream.getTracks().forEach(t => t.stop());
}

// 3. Capture â†’ Base64
function capture() {
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const output = document.getElementById("output");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  canvas.getContext("2d").drawImage(video, 0, 0);

  const base64 = canvas.toDataURL("image/jpeg");

  output.value = base64;
}
</script>

</body>
</html>
